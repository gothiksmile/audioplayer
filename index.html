<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Genially Audio Builder Fixed</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .panel { width: 380px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; margin-bottom: 5px; color: #666; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        .gen-btn { width: 100%; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .copy-btn { width: 100%; padding: 12px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; display: none; }
        #code-res { width: 100%; height: 60px; margin-top: 10px; display: none; font-size: 10px; }

        /* –ü—Ä–µ–≤—å—é —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ */
        .preview-area { margin-top: 20px; padding: 40px; background: #dfe6ed; border-radius: 20px; width: 500px; display: flex; justify-content: center; }
        .player-ui { width: 450px; height: 160px; display: flex; align-items: center; position: relative; }
        .disk { width: 140px; height: 140px; border-radius: 50%; border: 5px solid white; box-shadow: 0 8px 15px rgba(0,0,0,0.2); z-index: 2; overflow: hidden; background: #333; flex-shrink: 0; }
        .disk img { width: 100%; height: 100%; object-fit: cover; }
        .body { flex-grow: 1; height: 115px; margin-left: -50px; padding-left: 65px; border-radius: 15px; z-index: 1; display: flex; flex-direction: column; justify-content: center; color: white; }
    </style>
</head>
<body>

<div class="panel">
    <div class="input-group">
        <label>GitHub –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (user/repo)</label>
        <input type="text" id="repo" value="gothiksmile/audioplayer">
    </div>
    <div class="input-group">
        <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–æ–∂–∫—É</label>
        <input type="text" id="cover" value="https://images.genially.com/genial.ly/genially/templates/75f04896-efbd-4681-a9ad-29477c1afe78.png">
    </div>
    <div class="input-group">
        <label>–¶–≤–µ—Ç –ø–ª–µ–µ—Ä–∞</label>
        <input type="color" id="color" value="#5d6d7e">
    </div>
    <button class="gen-btn" onclick="generate()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
    <button id="copy-btn" class="copy-btn" onclick="copyCode()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è Genially</button>
    <textarea id="code-res"></textarea>
</div>

<div class="preview-area">
    <div class="player-ui">
        <div class="disk"><img id="p-img" src="https://images.genially.com/genial.ly/genially/templates/75f04896-efbd-4681-a9ad-29477c1afe78.png"></div>
        <div class="body" id="p-body">
            <div style="font-weight:bold">Preview Track</div>
            <div style="font-size:12px; opacity:0.7">Artist Name</div>
        </div>
    </div>
</div>

<script>
    const update = () => {
        document.getElementById('p-img').src = document.getElementById('cover').value;
        document.getElementById('p-body').style.backgroundColor = document.getElementById('color').value;
    };
    document.querySelectorAll('input').forEach(i => i.addEventListener('input', update));
    update();

    function generate() {
        const repo = document.getElementById('repo').value;
        const color = document.getElementById('color').value;
        const cover = document.getElementById('cover').value;

        // –ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ Genially
        const finalCode = `<div style="width:100%; min-width:460px; min-height:180px; display:flex; align-items:center; justify-content:center; background:transparent; overflow:visible;">
<div id="gs-p" style="width:450px; height:160px; display:flex; align-items:center; position:relative; font-family:sans-serif;">
<div style="width:140px; height:140px; border-radius:50%; border:5px solid #fff; box-shadow:0 8px 15px rgba(0,0,0,0.2); overflow:hidden; z-index:2; flex-shrink:0;">
<img src="${cover}" style="width:100%; height:100%; object-fit:cover;"></div>
<div style="flex-grow:1; height:115px; background:${color}; margin-left:-50px; padding-left:65px; padding-right:15px; border-radius:12px; color:#fff; display:flex; flex-direction:column; justify-content:center; z-index:1;">
<div id="gt" style="font-weight:bold; font-size:14px; margin-bottom:8px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
<div style="display:flex; align-items:center; gap:15px; font-size:20px;">
<span id="gp" style="cursor:pointer">‚èÆ</span><span id="ply" style="cursor:pointer; font-size:26px">‚ñ∂</span><span id="gn" style="cursor:pointer">‚è≠</span>
<span id="gs" style="cursor:pointer; margin-left:auto; font-size:16px; opacity:0.6">üîÄ</span><span id="gl" style="cursor:pointer; font-size:16px; opacity:0.6">‚ò∞</span>
</div><audio id="ga"></audio>
<div id="tpl" style="display:none; position:absolute; top:130px; left:65px; width:220px; background:rgba(0,0,0,0.9); border-radius:8px; padding:10px; max-height:120px; overflow-y:auto; font-size:11px; z-index:99;"></div>
</div></div></div>
<script>
(function(){
const r="${repo}", a=document.getElementById('ga'), t=document.getElementById('gt'), p=document.getElementById('ply');
let tracks=[], cur=0, shuf=false;
async function fetchTracks(){
const branches=['main','master'];
for(let b of branches){
const res=await fetch('https://api.github.com/repos/'+r+'/contents/?ref='+b);
if(res.ok){
const d=await res.json();
tracks=d.filter(f=>f.name.endsWith('.mp3')).map(f=>({name:f.name.replace('.mp3',''), url:f.download_url}));
if(tracks.length>0){setTrack(0); return;}
}}}
function setTrack(i){cur=i; a.src=tracks[i].url; t.innerText=tracks[i].name;}
p.onclick=()=>{if(a.paused){a.play().catch(e=>alert('–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞')); p.innerText="‚è∏"}else{a.pause(); p.innerText="‚ñ∂"}};
document.getElementById('gn').onclick=()=>{let n=shuf?Math.floor(Math.random()*tracks.length):(cur+1)%tracks.length; setTrack(n); a.play(); p.innerText="‚è∏"};
document.getElementById('gp').onclick=()=>{let n=(cur-1+tracks.length)%tracks.length; setTrack(n); a.play(); p.innerText="‚è∏"};
document.getElementById('gs').onclick=function(){shuf=!shuf; this.style.opacity=shuf?"1":"0.6"; this.style.color=shuf?"#ffeb3b":"#fff"};
document.getElementById('gl').onclick=()=>{const l=document.getElementById('tpl'); l.style.display=l.style.display==='none'?'block':'none';
l.innerHTML=tracks.map((x,i)=>'<div style="padding:5px; border-bottom:1px solid #444; cursor:pointer" onclick="window.goTrk('+i+')">'+x.name+'</div>').join('');};
window.goTrk=(i)=>{setTrack(i); a.play(); p.innerText="‚è∏"; document.getElementById('tpl').style.display='none'};
fetchTracks();})();<\/script>`;

        document.getElementById('code-res').value = finalCode;
        document.getElementById('code-res').style.display = 'block';
        document.getElementById('copy-btn').style.display = 'block';
    }

    function copyCode() {
        const text = document.getElementById('code-res');
        text.select();
        document.execCommand('copy');
        const btn = document.getElementById('copy-btn');
        btn.innerText = "‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
        setTimeout(() => btn.innerText = "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è Genially", 2000);
    }
</script>
</body>
</html>
